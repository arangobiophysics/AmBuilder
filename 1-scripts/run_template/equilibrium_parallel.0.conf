##############################################
# JOB DESCRIPTION                            #
##############################################

proc get_first_ts { xscfile } {
set fd [open $xscfile r]
gets $fd
gets $fd
gets $fd line
set ts [lindex $line 0]
close $fd
return $ts
}
##############################################
# Adjustable Parameters                      #
##############################################

structure          ../min/1.psf
coordinates        ../min/1.pdb

set restartflag    1
set temp     	   310.15


set ID [myReplica]

set inputname  ../min/1.eqnB
set outputname ./f$ID/f$ID

outputname         $outputname

#Continuing a job from the restart files
if { $restartflag } {
    set firsttime [get_first_ts $inputname.restart.xsc]
} else {
    set firsttime 0
}
#firsttimestep   $firsttime

# Restart setup
if { !$restartflag } { temperature $temp }

if { $restartflag } {
    binCoordinates ${inputname}.restart.coor
    binVelocities  ${inputname}.restart.vel
    extendedSystem ${inputname}.restart.xsc
}

restartfreq          5000
dcdfreq              5000
xstFreq              5000
outputEnergies       5000
outputPressure       5000
outputTiming         5000;                


##############################################
# Simulation Parameters                      #
##############################################

# Input
paraTypeCharmm     on

parameters /Scr/arango/Aditi-Files/forJustin/simulating.drugs/par/par_heme_ions.prm
parameters /Scr/arango/Aditi-Files/forJustin/simulating.drugs/par/stream/prot/toppar_all36_prot_heme.str
parameters /Scr/arango/Aditi-Files/forJustin/simulating.drugs/par/par_all36_lipid.prm
parameters /Scr/arango/Aditi-Files/forJustin/simulating.drugs/par/par_all36m_prot.prm
parameters /Scr/arango/membrane_AA/sepehr_build_fep/template_FEP/run/toppar/MZP.str
parameters /Scr/arango/Aditi-Files/forJustin/simulating.drugs/par/par_all36_cgenff.prm
parameters /Scr/arango/Aditi-Files/forJustin/simulating.drugs/par/toppar_water_ions_namd.str
parameters /Scr/arango/membrane_AA/sepehr_build_fep/template_FEP/run/toppar/toppar_all36_lipid_cholesterol.str
parameters /Scr/arango/ergosterol-amb/flooding_simulations/POPC.80.ERG.1.AMB.8/namd/toppar/toppar_all36_lipid_cholesterol.str
parameters /Scr/arango/ergosterol-amb/flooding_simulations/POPC.80.ERG.1.AMB.8/namd/toppar/toppar_all36_lipid_miscellaneous.str
parameters /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_cholesterol.str
parameters /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_cholesterol.str
parameters /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_sphingo.str
parameters /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_all36_lipid.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_all36m_prot.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_all36_na.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_all36_carb.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_all36_lipid.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_all36_cgenff.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/par_interface.prm
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_moreions.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_nano_lig.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_nano_lig_patch.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_synthetic_polymer.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_synthetic_polymer_patch.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_polymer_solvent.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_water_ions.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_dum_noble_gases.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_ions_won.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_arg0.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_c36m_d_aminoacids.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_fluoro_alkanes.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_heme.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_na_combined.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_retinol.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_model.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_prot_modify_res.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_na_nad_ppi.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_na_rna_modified.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_sphingo.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_archaeal.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_bacterial.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_cardiolipin.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_cholesterol.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_dag.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_inositol.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_lnp.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_lps.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_mycobacterial.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_miscellaneous.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_model.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_lipid_prot.str
parameters              /Scr/arango/ergosterol-amb/weighted_ensemble/template_WESTPA/toppar/toppar_all36_label_fluorophore.str
parameters ../par/ensemble/AMB.str               
parameters ../par/ensemble/AMB.prm
###############################################
#NAMD3 cuda option
CUDASOAintegrate on


wrapWater          on
wrapAll            on

#Force Field Parameters
exclude            scaled1-4
1-4scaling         1.0
cutoff             12.0
switching          on
switchdist         10.0
pairlistdist       13.5
stepspercycle      500
pairlistsPerCycle  50
vdwForceSwitching  on                   
margin 8  

# Integrator Parameters
timestep           2
rigidbonds         all
nonbondedfreq      1
fullElectFrequency 2
                              
################################################

# PME (for full-system periodic electrostatics)
PME                     yes;
PMEInterpOrder          4;                 
PMEGridSpacing          1.0;                
PMETolerance 10e-6
usePMECUDA         on

# Constant Temperature Control
langevin           on
langevinDamping    1                   # damping coefficient (gamma) of 1/ps
langevinTemp       $temp
langevinHydrogen   off           # don't couple langevin bath to hydrogens

# Constant Pressure Control
if {1} {
useGroupPressure       yes               # needed for rigidBonds
useFlexibleCell        no;             # yes for anisotropic system like membrane 
useConstantRatio       no;             # keeps the ratio of the unit cell in the x-y plane constant A=B

langevinPiston       on
langevinPistonTarget 1.01325           #  in bar -> 1 atm
langevinPistonPeriod 100.0
langevinPistonDecay  50.0
langevinPistonTemp   $temp
}

################################################

#Restraints

# Harmonic constraints
if {1} {
constraints             on
consexp                 2
consref                 ../min/1.bbC.const.pdb
conskfile               ../min/1.bbC.const.pdb
conskcol                B
#constraintScaling       0.50 # The harmonic constraint energy function is multiplied by this parameter, making it possible to gradually turn off constraints during equilibration
}


numsteps           250000000; #500ns
